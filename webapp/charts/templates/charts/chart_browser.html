  <!-- Interactive table for browsing raw chart entries with filters for country, month, search term, and explicit-only flag. -->

{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chart Browser â€“ Global Spotify Hits</title>
    <link
      rel="stylesheet"
      href="{% static 'charts/css/chart_browser.css' %}"
    />
  </head>
  <body>
    {% include "charts/partials/header.html" with active_page="browser" %}

    {# Main content area for this page #}
    <main class="page-container">
      <h1>Chart Browser</h1>
      <p class="subtitle">
        Browse the raw 2023 Spotify chart rows by country, month, artist, track
        name, and explicit flag.
      </p>

      {# Filter form section #}
      <form method="get" class="filters">
        <div class="filter-field">
          <label for="country">Country</label>
          <select name="country" id="country">
            <option value="">All countries</option>
            {% for c in countries %}
            <option
              value="{{ c.code }}"
              {% if c.code == country_query %}selected{% endif %}
            >
              {{ c.label }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-field">
          <label for="month">Month</label>
          <select name="month" id="month">
            <option value="">All months</option>
            {% for m in months %}
            <option
              value="{{ m.value }}"
              {% if m.value|stringformat:"s" == month_query %}selected{% endif %}
            >
              {{ m.label }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-field">
          <label for="search">Track or artist</label>
          <input
            type="text"
            id="search"
            name="search"
            value="{{ search_query }}"
            placeholder="Search by track or artist..."
          />
        </div>

        <div class="filter-field">
          <label>&nbsp;</label>
          <label class="filter-checkbox">
            <input
              type="checkbox"
              name="explicit_only"
              {% if explicit_only %}checked{% endif %}
            />
            Explicit only
          </label>
        </div>

        <div class="filter-actions">
          <button type="submit">Apply filters</button>
        </div>
      </form>

      {# Table container with scroll and pagination #}
      <section class="table-wrapper">
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th class="col-date">Date</th>
                <th class="col-country">Country</th>
                <th class="col-position">Pos.</th>
                <th>Track</th>
                <th>Artist</th>
                <th class="col-streams">Streams</th>
                <th>Explicit</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in page_obj.object_list %}
              <tr>
                <td>{{ entry.date }}</td>
                <td>{{ entry.pretty_country }}</td>
                <td class="col-position">{{ entry.position }}</td>
                <td>{{ entry.track_name }}</td>
                <td>{{ entry.artist }}</td>
                <td class="col-streams">{{ entry.streams }}</td>
                <td>{% if entry.explicit %}Yes{% else %}No{% endif %}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="empty-message">No data available.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="pagination">
          <div class="pagination__info">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
          </div>
          <div class="pagination__links">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&country={{ country_query }}&month={{ month_query }}&search={{ search_query }}{% if explicit_only %}&explicit_only=on{% endif %}">
              Previous
            </a>
            {% else %}
            <span>Previous</span>
            {% endif %}

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&country={{ country_query }}&month={{ month_query }}&search={{ search_query }}{% if explicit_only %}&explicit_only=on{% endif %}">
              Next
            </a>
            {% else %}
            <span>Next</span>
            {% endif %}
          </div>
        </div>
      </section>
    </main>
  </body>
</html>
